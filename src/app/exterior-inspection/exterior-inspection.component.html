<div *ngIf="isLoading" class="loading-overlay">
  <div class="loading-spinner"></div>
  <div class="loading-text">Data sedang dimuat...</div>
</div>

<div class="product-container">
    <div class="label-product">{{sampleDataInfo?.display_name}}</div>
    <div class="anakan-label">{{sampleDataInfo?.brand?.brand_name}} &#x25CF; {{sampleDataInfo?.variant_model?.model_name}}</div>

    <mat-accordion multi>
        <form #exteriorForm="ngForm">
            <div *ngFor="let subCategory of sortedExteriorKeys" style="padding-left:10px;margin-bottom:30px;">
                <mat-expansion-panel [expanded]="true"  id="{{subCategory}}"  (mouseenter)="onPanelInView(subCategory)">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            <span style="border:solid red 0px;font-weight:bold;">{{ subCategory }}</span>
                        </mat-panel-title>
                        <mat-panel-description></mat-panel-description>
                    </mat-expansion-panel-header>

                    <div style="display: flex; align-items: center; gap: 20px; padding: 10px 15px; background-color: #f5f5f5; border-bottom: 1px solid #ddd;margin-bottom:15px;">
                        <span style="font-weight: bold; font-size: 14px;">Pilih Semua:</span>
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 14px; cursor: pointer;">
                            <input type="radio" 
                                   name="selectAll_{{subCategory}}"
                                   class="custom-radio"
                                   (change)="selectAllInCategory(subCategory, 'Ada')"
                                   style="cursor: pointer;">
                            <span>Ada</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 14px; cursor: pointer;padding-left:60px;">
                            <input type="radio" 
                                   name="selectAll_{{subCategory}}"
                                   class="custom-radio"
                                   (change)="selectAllInCategory(subCategory, 'Tidak')"
                                   style="cursor: pointer;">
                            <span>Tidak</span>
                        </label>
                    </div>

                    <div *ngFor="let item of groupedSubItems['Exterior'][subCategory]">
                        <div>
                            <div *ngIf="item.questions && item.questions.length > 0">
                                <label style="font-weight: bold;text-transform: capitalize;width:50%;border:solid rgb(255, 251, 0) 0px;padding-left:15px;">
                                  {{ item.item_description }}
                                  <span *ngIf="hasIncompleteQuestions(item)" 
                                        class="warning-icon"
                                        style="color: #ff9800; margin-left: 8px; font-size: 16px;"
                                        title="Ada pertanyaan yang belum dijawab">
                                    ⚠️
                                  </span>
                                </label>
                                <div class="flex" style="gap: 25%">
                                    <label style="display: flex; align-items: center; gap: 15px; font-size: 14px; margin-left:10px;">
                                      <input type="radio"
                                             class="custom-radio"
                                             name="{{item.id}}_kondisi"
                                             [value]="'Ada'"
                                             [(ngModel)]="item.kondisi"
                                             (ngModelChange)="onSubmit(exteriorForm)" 
                                             (click)="openQuestionsModal(item)"/>
                                      Ada
                                    </label>

                                    <label style="display: flex; align-items: center; gap: 15px; font-size: 14px; margin-left:10px;">
                                      <input type="radio"
                                             class="custom-radio"
                                             name="{{item.id}}_kondisi"
                                             [value]="'Tidak'"
                                             [(ngModel)]="item.kondisi"
                                             (ngModelChange)="onSubmit(exteriorForm)" 
                                             />
                                      Tidak
                                    </label>

                                  
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </mat-expansion-panel>
            </div>
        </form>
    </mat-accordion>
</div>

<div *ngIf="isModalAnswerOpen" class="modal-overlay" (mousedown)="onModalOverlayClick($event)">
  <div class="modal-content" (mousedown)="$event.stopPropagation()">
    <h3 style="margin-bottom:10px;">{{ modalItem?.item_description }}</h3>
    <ng-container *ngFor="let question of modalQuestions; let i = index">
      <div *ngIf="question.name !== null" style="margin-bottom: 16px;">
        <!-- <label style="font-weight: bold;">{{ question.name }}</label> -->
        <select
          [id]="'selectEl_' + modalItem.id + '_' + i"
          class="mt-2 w-full p-2 border rounded"
          [name]="modalItem.id + '_' + question.key"
            (ngModelChange)="onSelectChange($event, exteriorForm)"
          [(ngModel)]="question.answer"
          style="text-transform: capitalize; font-size:14px; color: #0f0d0d;">
          <option [ngValue]="null" disabled style="color:#b4b4b4;">-- {{question.name}} --</option>
          <option style="color:#141414;" *ngFor="let option of question.options" [ngValue]="option">{{ option }}</option>
        </select>
      </div>
    </ng-container>
    <button type="button" class="flex items-center space-x-1 bg-red-600 text-white px-4 py-2 rounded-full wd45" (click)="closeQuestionsModal()" style="margin-top:20px;">Tutup</button>
  </div>
</div>

<!-- Modal Pilihan Baik/Rusak -->
<div *ngIf="isConditionModalOpen" class="condition-modal-overlay" (click)="closeConditionModal()">
  <div class="condition-modal-content" (click)="$event.stopPropagation()">
    <h3 class="modal-title">Set semua nilai pada item ini ke:</h3>
    <div class="condition-buttons">
      <button class="condition-btn condition-btn-baik" (click)="applyConditionToAll('Baik')">
        <i class="fas fa-check-circle btn-icon"></i>
        <span class="btn-label">Baik</span>
      </button>
      <button class="condition-btn condition-btn-rusak" (click)="applyConditionToAll('Rusak')">
        <i class="fas fa-times-circle btn-icon"></i>
        <span class="btn-label">Rusak</span>
      </button>
    </div>
  </div>
</div>